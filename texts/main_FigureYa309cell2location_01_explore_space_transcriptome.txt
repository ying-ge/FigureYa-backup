01_explore_space_transcriptome
数据下载：
https://data.mendeley.com/datasets/g67bkbnhhg/1
环境安装：
https://github.com/BayraktarLab/cell2location#Installation
conda
create
-
y
-
n
cell2loc_env
python
=
3.9
conda
activate
cell2loc_env
pip
install
cell2location
[
tutorials
]
将该环境注入jupyter notebook
conda
activate
cell2loc_env
conda
install
ipykernel
--
yes
python
-
m
ipykernel
install
--
user
--
name
=
cell2loc_env
--
display
-
name
=
'Environment (cell2loc_env)'
OR 【注意】在base环境下
conda
install
nb_conda
In [2]:
import
scanpy
as
sc
import
matplotlib.pyplot
as
plt
import
matplotlib
as
mpl
from
cell2location.utils
import
select_slide
我们首先需要熟悉空转在scanpy中的数据结构
In [21]:
adata_vis
=
sc
.
read_h5ad
(
"data/visium_merge_inter_upload.h5ad"
)
In [22]:
adata_vis
Out[22]:
important
注意adata_vis的数据结构：
切片图像保存于
adata_vis.uns['spatial']
在cell2location中，切片转录组默认使用
adata_vis.obs['sample']
用于区分不同切片的数据
修改
adata_vis.uns['spatial']
的key值使之和
adata_vis.obs['sample']
保持一致，这样才能使用
select_slide
函数根据切片subset数据
In [23]:
for
k
in
list
(
adata_vis
.
uns
[
'spatial'
]
.
keys
()):
adata_vis
.
uns
[
'spatial'
][
k
.
split
(
'_'
)[
3
]]
=
adata_vis
.
uns
[
'spatial'
]
.
pop
(
k
)
In [24]:
list
(
adata_vis
.
uns
[
'spatial'
]
.
keys
())
Out[24]:
In [25]:
adata_vis
.
obs
[[
'sample'
,
'donor_id'
]]
.
value_counts
()
Out[25]:
In [27]:
?
select_slide
In [26]:
## 选择切片画图
slide
=
select_slide
(
adata_vis
,
'6800STDY12499506'
)
sc
.
pl
.
spatial
(
slide
,
color
=
'PTPRC'
,
gene_symbols
=
'SYMBOL'
,
title
=
'CD45'
)